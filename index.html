<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Contacto para Webhook</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración para usar la fuente Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo gris claro */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Contenedor principal del formulario -->
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md border border-gray-100">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Registro de Contacto</h1>
        <p class="text-sm text-gray-500 mb-8 text-center">Completa los datos para enviar la información al sistema de automatización (n8n).</p>

        <!-- Formulario -->
        <form id="contactForm" class="space-y-5">

            <!-- Campo Nombre -->
            <div>
                <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                <input type="text" id="nombre" name="nombre" required
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
            </div>

            <!-- Campo Correo Electrónico -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico</label>
                <input type="email" id="email" name="email" required
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
            </div>

            <!-- Campo Mensaje -->
            <div>
                <label for="mensaje" class="block text-sm font-medium text-gray-700 mb-1">Mensaje o Comentario</label>
                <textarea id="mensaje" name="mensaje" rows="4" required
                          class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 resize-none"></textarea>
            </div>

            <!-- Botón de Envío -->
            <button type="submit" id="submitButton"
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out disabled:opacity-50">
                Enviar Datos al Webhook
            </button>
        </form>

        <!-- Área de Mensajes (Éxito o Error) -->
        <div id="messageArea" class="mt-6 text-center">
            <!-- Los mensajes se mostrarán aquí -->
        </div>
    </div>

    <!-- Script de JavaScript para el envío de datos -->
    <script>
        // La URL del webhook proporcionada por el usuario
        const WEBHOOK_URL = 'https://cristobalmaier.app.n8n.cloud/webhook-test/formulario-web';

        document.getElementById('contactForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Evita el envío tradicional del formulario

            const form = event.target;
            const submitButton = document.getElementById('submitButton');
            const messageArea = document.getElementById('messageArea');

            // Recolección de datos del formulario
            const formData = {
                nombre: form.nombre.value,
                email: form.email.value,
                mensaje: form.mensaje.value
            };

            // Convertir el objeto de datos a formato URL-encoded (application/x-www-form-urlencoded)
            // Este formato es más compatible con la configuración predeterminada de muchos webhooks (incluyendo n8n)
            // cuando no están configurados para JSON.
            const urlEncodedData = new URLSearchParams();
            for (const [key, value] of Object.entries(formData)) {
                urlEncodedData.append(key, value);
            }

            // Mostrar estado de carga y deshabilitar botón
            messageArea.innerHTML = '<p class="text-indigo-600 font-semibold flex items-center justify-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Enviando datos...</p>';
            submitButton.disabled = true;

            try {
                // Realizar la solicitud POST al webhook
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded' // Cambiado a URL-encoded
                    },
                    body: urlEncodedData.toString() // Envía los datos como string URL-encoded
                });

                // Comprobar la respuesta del webhook (un 200/204 es éxito)
                if (response.ok) {
                    messageArea.innerHTML = '<p class="text-green-600 font-bold p-3 bg-green-50 rounded-lg">¡Éxito! Datos enviados correctamente al webhook.</p>';
                    form.reset(); // Limpiar el formulario
                } else {
                    // Manejar respuestas que no son exitosas
                    const errorText = await response.text();
                    messageArea.innerHTML = `<p class="text-red-600 font-bold p-3 bg-red-50 rounded-lg">Error al enviar (${response.status}): ${errorText.substring(0, 100)}</p>`;
                }
            } catch (error) {
                // Manejar errores de red (por ejemplo, si la URL no existe o CORS)
                console.error('Error de red:', error);
                messageArea.innerHTML = '<p class="text-red-600 font-bold p-3 bg-red-50 rounded-lg">Error de conexión. Revisa la consola para más detalles.</p>';
            } finally {
                // Habilitar el botón de nuevo
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>
